<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLYY</title>
    <link rel="stylesheet" href="../static/css/style.css">
</head>
<body>
    <!-- 헤더 -->
    <header class="header">
        <div class="align both">
            <div><button class="btn-logo" aria-label="플리 로고"></button></div>
            <div class="header__icon-group">
                <button class="btn-bell--default" aria-label="알림 없음"></button>
                <!-- <button class="btn-bell--new" aria-label="새로운 알림 있음"></button> -->
                <button class="btn-mylikes" aria-label="나의 좋아요"></button>
                <button class="btn-myprofile2" aria-label="내 프로필"></button>
            </div>
        </div>
    </header>
    <!-- 메인 -->
    <main class="main">
        <div class="main__container">
            <!-- 큐레에터 상세 -->
            <div class="c-img" id="curatorInfo">
                <!-- <img src="images/@c_img2.jpg" alt="" class="c-img__curator-img">
                <div class="c-img__info">
                    <div class="c-img__info__curator align left">
                        <span class="fs20">curator</span>
                        <span class="fs20-bold">별하나하나별하나하나별하</span>
                    </div>
                    <p class="fs14">고양고양고양고양고양고양고양고양고양고양고양고양고양고양</p>
                </div> -->
            </div>
            <!-- 큐레이터 상세 타이틀 -->
            <div class="title-type2">
                <div class="align both">
                    <div class="title-type2__info fs14">발행 플리 : <span class="fs14" id="plyyCount"></span></div>
                    <div class="title-type2__like">
                        <button class="btn-curator-heart"></button>
                        <span class="fs14 curatorLikes">0</span>
                    </div>
                </div>
            </div>
            <!-- 플리카드 -->
            <ul class="plyy-card mg32" id="curatorPlyyCardUl">
                <!-- <li>
                    <a href="">
                        <div class="plyy-card__top">
                            <img src="images/@plyy_img.svg" alt="" class="plyy-card__top__img">
                            <div class="badge green"><span class="hide">플레이리스트 상태</span>NEW</div>
                            <div class="plyy-card__top__tag-list">
                                <div class="badge tag"># 태그</div>
                                <div class="badge tag"># 태그</div>
                            </div>
                            <button class="btn-plike--unfill" aria-label="플레이리스트 좋아요 즐겨찾기"></button>
                        </div>
                        <div class="plyy-card__bottom">
                            <div>
                                <div class="plyy-card__bottom__title fs16"><span class="hide">플레이리스트 제목</span>플레이리스트 타이틀</div>
                                <div class="align both">
                                    <div class="plyy-card__bottom--cname fs12"><span class="hide">큐레이터 이름</span>curator  이름</div>
                                    <div class="plyy-card__bottom--count fs12"><span class="hide">총 수록곡, 총 플레이타임</span>00곡 | 0시간 00분</div>
                                </div>
                            </div>
                        </div>
                    </a>
                </li> -->
            </ul>
            <!-- 큐레이터상세 플로팅 바 -->
            <div class="fixed-floating">
                <div class="floating-curator">
                    <div><button class="btn__float__arrow__left" aria-label="뒤로가기"></button></div>
                    <div class="like-group">
                        <button class="btn__float__like" aria-label="큐레이터 좋아요 수"></button>
                        <span class="fs12 curatorLikes">98</span>
                    </div>
                    <div><button class="btn__float__share--black" aria-label="큐레이터 공유하기"></button></div>
                </div>
            </div>
        </div>
    </main>
    <!-- 푸터 : 현재 이미지 박아넣음. 추후 컴포넌트화 필요-->
    <footer class="footer">
        <div>
            <div class="footer__img"></div>
        </div>
    </footer>
    <script>
        // 특정 큐레이터 아이디 가져오기
        let curatorPath = window.location.pathname;
        let curatorPathArray = curatorPath.split('/');
        let curatorId = curatorPathArray[curatorPathArray.length - 1]

        //
        function fetchCuratorDetail() {
            fetch(`/api_curator_detail/${curatorId}`)
            .then(response => response.json())
            .then(data => {
                // 큐레이터 정보
                let curatorInfo = document.getElementById("curatorInfo");
                curatorInfo.innerHTML = `
                <img src="../static/img/${data.curator.img}" alt="" class="c-img__curator-img">
                <div class="c-img__info">
                    <div class="c-img__info__curator align left">
                        <span class="fs20">curator</span>
                        <span class="fs20-bold">${data.curator.name}</span>
                    </div>
                    <p class="fs14">${data.curator.intro}</p>
                </div>
                `;

                // 타이틀 - 발행 플리 수
                const plyyCount = document.getElementById("plyyCount");
                plyyCount.innerText = data.curator.plyy_count;

                // 타이틀 & 플로팅바 - 큐레이터 좋아요 수
                const curatorLikes = document.getElementsByClassName("curatorLikes");
                for(i=0; i<curatorLikes.length; i++){
                    curatorLikes[i].innerText = data.curator.c_likes;
                }
            })
        }

        // 큐레이터 상세 API fetch
        function fetchCuratorDetailCards(){
            fetch(`/api_curator_detail_plyy_cards/${curatorId}`)
            .then(response => response.json())
            .then(data => {
                console.log(data)
                const curatorPlyyCardUl = document.getElementById("curatorPlyyCardUl");
                data.forEach(data => {
                    console.log(data)
                    const newCuratorPlyyCardLi = document.createElement('li');
                    newCuratorPlyyCardLi.innerHTML = `
                    <a href="/plyy/${data.c_plyy_card.plyy_id}">
                        <div class="plyy-card__top">
                            <img src="../static/img/${data.c_plyy_card.plyy_img}" alt="" class="plyy-card__top__img">
                            <div class="badge green"><span class="hide">플레이리스트 상태</span>NEW</div> <!-- hide 클래스 : 화면난독기용, 보이지 않음-->
                            <div class="plyy-card__top__tag-list">
                                <div class="badge tag"># ${data.c_plyy_card.g_name}</div>
                                <div class="badge tag"># ${data.c_plyy_card.tag_list[0]}</div>
                            </div>
                            <button class="btn-plike--unfill" aria-label="플레이리스트 좋아요 즐겨찾기"></button>
                        </div>
                        <div class="plyy-card__bottom">
                            <div>
                                <div class="plyy-card__bottom__title fs16"><span class="hide">플레이리스트 제목</span>${data.c_plyy_card.plyy_title}</div>
                                <div class="align both">
                                    <div class="plyy-card__bottom--cname fs12"><span class="hide">큐레이터 이름</span>curator  ${data.c_plyy_card.c_name}</div>
                                    <div class="plyy-card__bottom--count fs12"><span class="hide">총 수록곡, 총 플레이타임</span>${data.c_plyy_card.total_songs}곡 | ${data.c_plyy_card.total_rtime}</div>
                                </div>
                            </div>
                        </div>
                    </a>
                    `;
                    curatorPlyyCardUl.appendChild(newCuratorPlyyCardLi);
                })
            }).catch(error => console.error('데이터를 처리하는 과정에서 오류가 발생하였습니다.', error));
        };

        // 
        window.onload = function() {
            fetchCuratorDetail();
            fetchCuratorDetailCards();
        };
    </script>
</body>
</html>