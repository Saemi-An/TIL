<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta content="yes" name="apple-mobile-web-app-capable" />  
    <meta content="minimum-scale=1.0, width=device-width, maximum-scale=1, user-scalable=no" name="viewport" />

    <title>PLYY</title>
    <link rel="stylesheet" href="../static/css/style.css">
</head>
<body>
    <!-- 헤더 -->
    <header class="header">
        <div class="align both">
            <div><button class="btn-logo" aria-label="플리 로고"></button></div>
            <div class="header__icon-group">
                <button class="btn-bell--default" aria-label="알림 없음"></button>
                <!-- <button class="btn-bell--new" aria-label="새로운 알림 있음"></button> -->
                <button class="btn-mylikes" aria-label="나의 좋아요"></button>
                <button class="btn-myprofile2" aria-label="내 프로필"></button>
            </div>
        </div>
    </header>
    <!-- 메인 -->
    <main class="main">
        <div class="main__container">
            <!-- 플리 상세 타이틀 : 줄바꿈 없음 -->
            <div id="plyyTitle">
                <!-- <div class="title-type1">
                    <div><p class="h2">Last Summer Swing Vol. 3 
                        / LL YOON J MIX #12</p></div>
                </div>
                <div class="plyy-info align both pd8">
                    <div class="fs12">발행일 : 2024.08.02</div>
                    <div class="fs12">큐레이터 : LL YOON J</div>
                    <div class="fs12">00곡 | 1시간 2분</div>
                </div> -->
            </div>
            <!-- 플리 상세 목록 -->
            <div class="plyy">
                <div class="plyy__top">
                    <div>
                        <ul class="plyy__top__tag" id="plyyTagUl">
                            <!-- <li class="badge tag fs12"># RNB</li> -->
                        </ul>
                    </div>
                    <div class="plyy__top__intro pretendard" id="plyyCmt"></div>
                </div>
                <div class="plyy__bottom">
                    <ul class="plyy__bottom__song-list" id="plyySongUl">
                        <!-- <li>
                            <a href="" class="plyy__bottom__song-list__card">
                                <div class="plyy__bottom__song-list__card__img"><img src="images/@album_img.svg"></div>
                                <div class="plyy__bottom__song-list__card__info">
                                    <div class="fs14-bold">곡 제목</div>
                                    <div class="fs14">아티스트</div>
                                </div>
                                <div class="plyy__bottom__song-list__card__runtime fs14">3 : 02</div>
                            </a>
                        </li> -->
                    </ul>
                </div>
            </div>
            <!-- 플리상세 플로팅 바 -->
            <div class="fixed-floating">
                <div class="floating-plyy">
                    <div><button class="btn__float__arrow__left" aria-label="뒤로가기"></button></div>
                    <div class="like-group">
                        <button class="btn__float__like" aria-label="플레이리스트 좋아요 수"></button>
                        <span class="fs12">98</span>
                    </div>
                    <div><button class="btn__float__share--black" aria-label="플레이리스트 공유하기"></button></div>
                </div>
            </div>
        </div>
    </main>
    <!-- 푸터 : 현재 이미지 박아넣음. 추후 컴포넌트화 필요-->
    <footer class="footer">
        <div>
            <div class="footer__img"></div>
        </div>
    </footer>
    <script>
        // window.onload에서 미리 불러와야할 함수들 호출
        window.onload = function() {
            fetchPlyyDetail();
        };
        
        // 플리 상세 fetch API
        function fetchPlyyDetail() {
            
            // URL에서 플리 아이디 가져오기
            let plyyPath = window.location.pathname;
            let plyyPathList = plyyPath.split('/');
            const plyyID = plyyPathList[plyyPathList.length - 1];

            // 해당 플리 아이디로 플리 디테일 API fetch
            fetch(`/api_plyy_detail/${plyyID}`)
            .then(response => response.json())
            .then(data => {

                // 플리 상세 타이틀
                const plyyTitle = document.getElementById('plyyTitle');
                plyyTitle.innerHTML = `
                <div>
                    <div class="title-type1">
                        <div><p class="h2">${data.plyy.title}</p></div>
                    </div>
                    <div class="plyy-info align both pd8">
                        <div class="fs12">발행일 : ${data.plyy.gen_date}</div>
                        <div class="fs12">큐레이터 : ${data.plyy.c_name}</div>
                        <div class="fs12">${data.plyy.total_songs}곡 | ${data.plyy.total_rtime}</div>
                    </div>
                </div>
                `;

                // 플리 상세 상단 - 태그
                const plyyTagList = data.plyy.tag_list;
                const plyyTagUl = document.getElementById('plyyTagUl');
                plyyTagList.forEach(plyyTagList => {
                    const newPlyyTagLi = document.createElement("li");
                    newPlyyTagLi.classList.add("badge", "tag", "fs12");
                    newPlyyTagLi.innerText = `# ${plyyTagList}`;
                    plyyTagUl.appendChild(newPlyyTagLi);
                });

                // 플리 상세 상단 - 코멘트
                const plyyCmt = document.getElementById("plyyCmt");
                plyyCmt.innerText = data.plyy.cmt;

                // 플리 상세 하단 - 곡 목록
                const songList = data.plyy.song_list;
                songList.forEach(songList => {
                    const plyySongUl = document.getElementById("plyySongUl");
                    const newPlyySongLi = document.createElement('li');
                    newPlyySongLi.innerHTML = `
                        <a href="" class="plyy__bottom__song-list__card">
                            <div class="plyy__bottom__song-list__card__img"><img src="${songList.img}"></div>
                            <div class="plyy__bottom__song-list__card__info">
                                <div class="fs14-bold">${songList.title}</div>
                                <div class="fs14">${songList.artist}</div>
                            </div>
                            <div class="plyy__bottom__song-list__card__runtime fs14">${songList.rtime}</div>
                        </a>
                    `;
                    plyySongUl.appendChild(newPlyySongLi);
                });
            });
        };
    </script>
</body>
</html>